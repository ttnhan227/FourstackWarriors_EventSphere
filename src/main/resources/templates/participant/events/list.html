<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Events</title>
    <style>
    .text-warning {
        color: #ff9800;
    }
    .text-success {
        color: #4caf50;
    }
    .flash-message {
        font-size: 1.2em;
        font-weight: bold;
        margin-bottom: 1em;
    }
    </style>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport"/>
    <link rel="stylesheet" th:href="@{/css/home/main.css}"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
</head>
<body class="is-preload">

<!-- Wrapper -->
<div id="wrapper">

    <!-- Main -->
    <div id="main">
        <div class="inner">
            <!-- Header -->
            <header id="header">
                <a class="logo" th:href="@{/}"><strong>EventSphere</strong> - Events</a>
            </header>

            <!-- Content -->
            <section>
                <!-- Heading -->
                <header class="major">
                    <h2 th:if="${isPast}">Past Events</h2>
                    <h2 th:unless="${isPast}">
                        <span th:if="${category}" th:text="'Events - ' + ${category}"></span>
                        <span th:unless="${category}">Upcoming Events</span>
                    </h2>
                </header>

                <!-- Filters -->
                <div class="box alt" style="margin-bottom: 2em;">
                    <div class="row gtr-50 gtr-uniform">
                        <div class="col-6 col-12-small">
                            <a th:class="${!isPast} ? 'button primary fit' : 'button fit'"
                               th:href="@{/participant/events/list}">
                                Upcoming
                            </a>
                        </div>
                        <div class="col-6 col-12-small">
                            <a th:class="${isPast} ? 'button primary fit' : 'button fit'"
                               th:href="@{/participant/events/past}">
                                Past
                            </a>
                        </div>
                        <div class="col-12" style="margin-top: 1em;">
                            <h4>Categories</h4>
                            <a th:class="'button small ' + (${category == null} ? 'primary' : '')"
                               th:href="@{/participant/events}">
                                All
                            </a>
                            <a th:class="'button small ' + (${category == cat} ? 'primary' : '')"
                               th:each="cat : ${categories}"
                               th:href="@{/participant/events(category=${cat})}"
                               th:text="${cat}">
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Events List -->
                <div class="posts">
                    <article th:each="event : ${events}">
                        <a class="image" th:href="@{/participant/events/{id}(id=${event.eventId})}">
                            <img alt="Event Image"
                                 style="width: 100%; height: 200px; object-fit: cover;"
                                 th:src="${event.imageUrl != null ? event.imageUrl : '/images/events/event-placeholder.jpg'}"/>
                        </a>
                        <div class="event-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5em;">
                            <h3 style="margin: 0;" th:text="${event.title}">Event Title</h3>
                            <span th:class="'status-badge ' + 
                                         ${event.status == 'APPROVED' ? 'status-confirmed' : 
                                          event.status == 'PENDING' ? 'status-pending' : 
                                          event.status == 'CANCELLED' ? 'status-cancelled' : 'status-waitlist'}"
                                  th:text="${#strings.toLowerCase(event.status)}">
                            </span>
                        </div>
                        
                        <p style="margin: 0.5em 0;" th:text="${event.description}">Event description</p>
                        
                        <p style="margin: 0.3em 0;">
                            <i class="fas fa-map-marker-alt" style="width: 1.2em;"></i>
                            <span th:if="${event.venue != null}" th:text="${event.venue.name}">Venue Name</span>
                            <span th:unless="${event.venue != null}">Online</span>
                        </p>
                        
                        <p style="margin: 0.3em 0;">
                            <i class="far fa-calendar-alt" style="width: 1.2em;"></i>
                            <span th:text="${#temporals.format(event.startDate, 'EEE, MMM d, yyyy')} + ' • ' + 
                                           ${#temporals.format(event.startDate, 'h:mm a')} + ' - ' +
                                           ${#temporals.format(event.endDate, 'h:mm a')}">
                                Date and time
                            </span>
                        </p>
                        
                        <p style="margin: 0.3em 0;" th:if="${event.startDate.isAfter(#temporals.createNow())}">
                            <i class="far fa-clock"></i>
                            <span th:if="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd') == #temporals.format(event.startDate, 'yyyy-MM-dd')}">
                                Starting today at <span th:text="${#temporals.format(event.startDate, 'h:mm a')}"></span>
                            </span>
                            <span th:unless="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd') == #temporals.format(event.startDate, 'yyyy-MM-dd')}">
                                <span th:text="'Starts ' + ${#temporals.format(event.startDate, 'MMM d')}"></span>
                            </span>
                        </p>
                        <p th:if="${event.eventSeating != null}">
                            <i class="fas fa-chair"></i>
                            <span th:if="${event.eventSeating.getAvailableSeat() > 0}">
                                <span th:text="${event.eventSeating.getAvailableSeat()}"></span> of 
                                <span th:text="${event.eventSeating.totalSeats}"></span> seats available
                            </span>
                            <span th:unless="${event.eventSeating.getAvailableSeat() > 0}" class="text-warning">
                                <i class="fas fa-exclamation-circle"></i> Event is full
                                <span th:if="${event.eventSeating.waitlistEnabled}"> (Waitlist available)</span>
                            </span>
                        </p>
                        <ul class="actions">
                            <li>
                                <a class="button" th:href="@{/participant/events/{id}(id=${event.eventId})}">
                                    View Details
                                </a>
                            </li>
                        </ul>
                    </article>
                    <article th:if="${#lists.isEmpty(events)}">
                        <p>No events found.</p>
                    </article>
                </div>

                <!-- Pagination -->
                <ul class="pagination" th:if="${events.totalPages > 1}">
                    <li>
                        <a class="button small" th:with="baseUrl=${isPast ? '/participant/events/past' : '/participant/events/list'}"
                           th:href="@{${baseUrl}(page=0, category=${category != null ? category : ''})}">
                            « First
                        </a>
                    </li>
                    <li>
                        <a th:class="${events.first} ? 'button small disabled' : 'button small'"
                           th:with="baseUrl=${isPast ? '/participant/events/past' : '/participant/events/list'}"
                           th:href="@{${baseUrl}(page=${events.number - 1}, category=${category != null ? category : ''})}">
                            ‹ Prev
                        </a>
                    </li>

                    <li th:each="i : ${#numbers.sequence(1, events.totalPages)}">
                        <a th:class="${i - 1 == events.number} ? 'button small primary' : 'button small'"
                           th:with="baseUrl=${isPast ? '/participant/events/past' : '/participant/events/list'}"
                           th:href="@{${baseUrl}(page=${i - 1}, category=${category != null ? category : ''})}"
                           th:text="${i}">
                        </a>
                    </li>

                    <li>
                        <a th:class="${events.last} ? 'button small disabled' : 'button small'"
                           th:with="baseUrl=${isPast ? '/participant/events/past' : '/participant/events/list'}"
                           th:href="@{${baseUrl}(page=${events.number + 1}, category=${category != null ? category : ''})}">
                            Next ›
                        </a>
                    </li>
                    <li>
                        <a class="button small" 
                           th:with="baseUrl=${isPast ? '/participant/events/past' : '/participant/events/list'}"
                           th:href="@{${baseUrl}(page=${events.totalPages - 1}, category=${category != null ? category : ''})}">
                            Last »
                        </a>
                    </li>
                </ul>
            </section>
        </div>
    </div>

    <!-- Sidebar -->
    <div th:replace="~{layout/sidebar-layout :: sidebar}"></div>

</div>

<!-- Scripts -->
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/browser.min.js}"></script>
<script th:src="@{/js/breakpoints.min.js}"></script>
<script th:src="@{/js/util.js}"></script>
<script th:src="@{/js/main.js}"></script>

</body>
</html>
