<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/participant-layout}">
<head>
    <title>Events</title>
    <link rel="stylesheet" th:href="@{/css/events.css}">
</head>
<body>
<div layout:fragment="content">
    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 th:if="${isPast}">Past Events</h2>
            <h2 th:unless="${isPast}">
                <span th:if="${category}" th:text="'Events - ' + ${category}"></span>
                <span th:unless="${category}">Upcoming Events</span>
            </h2>
            
            <div class="btn-group">
                <a th:href="@{/participant/events}" 
                   th:class="${!isPast} ? 'btn btn-primary' : 'btn btn-outline-primary'">
                    Upcoming
                </a>
                <a th:href="@{/participant/events/past}" 
                   th:class="${isPast} ? 'btn btn-primary' : 'btn btn-outline-primary'">
                    Past Events
                </a>
            </div>
        </div>

        <!-- Category Filter -->
        <div class="mb-4">
            <div class="btn-group">
                <a th:href="@{/participant/events}" 
                   th:class="'btn btn-sm ' + (${category == null} ? 'btn-dark' : 'btn-outline-dark')">
                    All Categories
                </a>
                <a th:each="cat : ${categories}"
                   th:href="@{/participant/events(category=${cat})}"
                   th:class="'btn btn-sm ' + (${category == cat} ? 'btn-dark' : 'btn-outline-dark')"
                   th:text="${cat}">
                </a>
            </div>
        </div>

        <!-- Events Grid -->
        <div th:if="${!events.empty}" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            <div th:each="event : ${events}" class="col mb-4">
                <div class="card h-100 shadow-sm">
                    <img th:src="${event.imageUrl != null ? event.imageUrl : '/images/event-placeholder.jpg'}" 
                         th:attr="src=${event.imageUrl != null ? event.imageUrl : '/images/event-placeholder.jpg'}"
                         class="card-img-top" 
                         alt="Event image" 
                         style="height: 200px; object-fit: cover;">
                    <div class="card-body">
                        <span class="badge bg-primary mb-2" th:text="${event.category}"></span>
                        <h5 class="card-title" th:text="${event.title}"></h5>
                        <p class="card-text text-muted small" th:text="${event.description.length() > 100} ? 
                            ${#strings.abbreviate(event.description, 100)} : ${event.description}"></p>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted" 
                                   th:text="${#temporals.format(event.startDate, 'MMM dd, yyyy')} + ' at ' + 
                                           ${#temporals.format(event.startDate, 'h:mm a')}"></small>
                            <a th:href="@{/participant/events/{id}(id=${event.eventId})}" 
                               class="btn btn-sm btn-outline-primary">View Details</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- No Events Message -->
        <div th:if="${events.empty}" class="text-center py-5">
            <i class="bi bi-calendar-x fs-1 text-muted"></i>
            <h4 class="mt-3">No events found</h4>
            <p class="text-muted">There are currently no events available.</p>
        </div>

        <!-- Pagination -->
        <nav th:if="${events.totalPages > 1}" class="mt-4">
            <ul class="pagination justify-content-center">
                <!-- First Page -->
                <li class="page-item" th:classappend="${events.first} ? 'disabled'">
                    <a th:href="@{${'/' + #httpServletRequest.requestURI + '?page=0' + (category != null ? '&category=' + category : '')}}" 
                       class="page-link">
                        <span>&laquo;&laquo;</span>
                    </a>
                </li>
                
                <!-- Previous Page -->
                <li class="page-item" th:classappend="${events.first} ? 'disabled'">
                    <a th:href="@{${'/' + #httpServletRequest.requestURI + '?page=' + (events.number - 1) + (category != null ? '&category=' + category : '')}}" 
                       class="page-link">
                        <span>&laquo;</span>
                    </a>
                </li>

                <!-- Page Numbers -->
                <li th:each="i : ${#numbers.sequence(1, events.totalPages)}" 
                    th:classappend="${i-1 == events.number} ? 'active'" 
                    class="page-item">
                    <a th:href="@{${'/' + #httpServletRequest.requestURI + '?page=' + (i-1) + (category != null ? '&category=' + category : '')}}" 
                       class="page-link" 
                       th:text="${i}"></a>
                </li>

                <!-- Next Page -->
                <li class="page-item" th:classappend="${events.last} ? 'disabled'">
                    <a th:href="@{${'/' + #httpServletRequest.requestURI + '?page=' + (events.number + 1) + (category != null ? '&category=' + category : '')}}" 
                       class="page-link">
                        <span>&raquo;</span>
                    </a>
                </li>
                
                <!-- Last Page -->
                <li class="page-item" th:classappend="${events.last} ? 'disabled'">
                    <a th:href="@{${'/' + #httpServletRequest.requestURI + '?page=' + (events.totalPages - 1) + (category != null ? '&category=' + category : '')}}" 
                       class="page-link">
                        <span>&raquo;&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>

<!-- Add this in the head section of your layout -->
<th:block layout:fragment="styles">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .card {
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }
        .page-item.active .page-link {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
        .badge {
            font-weight: 500;
        }
    </style>
</th:block>
</body>
</html>
