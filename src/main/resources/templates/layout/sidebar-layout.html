<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
>
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport"/>
    <link rel="stylesheet" th:href="@{/css/home/main.css}"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <style>
        .welcome-text {
            margin-right: 15px;
            color: #4a6da7;
            font-weight: 500;
        }

        .logout-form {
            margin: 0;
            padding: 0;
            display: inline;
        }

        .logout-form button {
            background: none;
            border: none;
            color: #4a6da7;
            cursor: pointer;
            padding: 0 15px;
            font-size: 0.8em;
            height: 2.75em;
            line-height: 2.75em;
        }

        .logout-form button:hover {
            background-color: rgba(74, 109, 167, 0.1);
        }
    </style>
</head>
<body>
<!-- Sidebar Fragment -->
<div id="sidebar" th:fragment="sidebar">
    <div class="inner">

        <!-- Search -->
        <section class="alt" id="search">
            <form action="#" method="post">
                <input id="query" name="query" placeholder="Search" type="text"/>
            </form>
        </section>

        <!-- Auth Section -->
        <section class="auth-section" style="margin: 1.5em 0;">
            <ul class="actions stacked" style="margin-bottom: 0;">
                <li style="text-align: center;" th:if="${#authorization.expression('isAuthenticated()')}">
                    <span class="welcome-text">Welcome, 
                        <span th:text="${#authentication.name}"></span>!
                    </span>
                </li>
                <li th:if="${#authorization.expression('isAuthenticated()')}">
                    <form method="post" style="margin: 0;" th:action="@{/logout}">
                        <button class="button fit" style="margin: 0.5em 0;" type="submit">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </form>
                </li>
                <li th:if="${!#authorization.expression('isAuthenticated()')}">
                    <a class="button primary fit" style="margin: 0.5em 0 0 0;" th:href="@{/auth/login}">Login</a>
                </li>
                <li th:if="${!#authorization.expression('isAuthenticated()')}">
                    <a class="button fit" style="margin: 0.5em 0;" th:href="@{/auth/register}">Register</a>
                </li>
            </ul>
        </section>

        <!-- Menu -->
        <nav id="menu">
            <header class="major">
                <h2>Menu</h2>
            </header>
            <ul>
                <li><a th:href="@{/}">Homepage</a></li>
                <li th:if="${#authorization.expression('isAuthenticated()')}">
                    <a th:href="@{/profile}">My Profile</a>
                </li>
                <li th:if="${#authorization.expression('hasRole(''PARTICIPANT'')')}">
                    <a th:href="@{/participant/dashboard}">My Dashboard</a>
                </li>
                <li th:if="${#authorization.expression('hasRole(''PARTICIPANT'')')}">
                    <a th:href="@{/certificates}">My Certificates</a>
                </li>
                <li th:if="${#authorization.expression('hasRole(''ORGANIZER'')')}">
                    <a th:href="@{/organizer/index}">List Events</a>
                </li>
                <li th:if="${#authorization.expression('hasRole(''ORGANIZER'')')}">
                    <a th:href="@{/organizer/create}">Create new Event</a>
                </li>
                <li th:if="${#authorization.expression('hasRole(''ORGANIZER'')')}">
                    <a th:href="@{/organizer/createVenue}">Create new Venue</a>
                <li th:if="${#authorization.expression('hasRole(''ORGANIZER'')')}">
                    <a th:href="@{/organizer/createHost}">Create new Host</a>
                <li th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
                    <a th:href="@{/admin/index}">Admin Dashboard</a>
                </li>
                <li><a th:href="@{/generic}">Generic</a></li>
                <li><a th:href="@{/elements}">Elements</a></li>
                <li>
                    <span class="opener">Submenu</span>
                    <ul>
                        <li><a href="#">Lorem Dolor</a></li>
                        <li><a href="#">Ipsum Adipiscing</a></li>
                        <li><a href="#">Tempus Magna</a></li>
                        <li><a href="#">Feugiat Veroeros</a></li>
                    </ul>
                </li>
                <li><a href="#">Etiam Dolore</a></li>
                <li><a href="#">Adipiscing</a></li>
                <li>
                    <span class="opener">Another Submenu</span>
                    <ul>
                        <li><a href="#">Lorem Dolor</a></li>
                        <li><a href="#">Ipsum Adipiscing</a></li>
                        <li><a href="#">Tempus Magna</a></li>
                        <li><a href="#">Feugiat Veroeros</a></li>
                    </ul>
                </li>
                <li><a href="#">Maximus Erat</a></li>
                <li><a href="#">Sapien Mauris</a></li>
                <li><a href="#">Amet Lacinia</a></li>
            </ul>
        </nav>

        <!-- Section -->
        <section>
            <header class="major">
                <h2>Ante interdum</h2>
            </header>
            <div class="mini-posts">
                <article>
                    <a class="image" href="#"><img alt="" src="/images/home/pic07.jpg"/></a>
                    <p>Aenean ornare velit lacus, ac varius enim lorem ullamcorper dolore aliquam.</p>
                </article>
                <article>
                    <a class="image" href="#"><img alt="" src="/images/home/pic08.jpg"/></a>
                    <p>Aenean ornare velit lacus, ac varius enim lorem ullamcorper dolore aliquam.</p>
                </article>
                <article>
                    <a class="image" href="#"><img alt="" src="/images/home/pic09.jpg"/></a>
                    <p>Aenean ornare velit lacus, ac varius enim lorem ullamcorper dolore aliquam.</p>
                </article>
            </div>
            <ul class="actions">
                <li><a class="button" href="#">More</a></li>
            </ul>
        </section>

        <!-- Section -->
        <section>
            <header class="major">
                <h2>Get in touch</h2>
            </header>
            <p>Sed varius enim lorem ullamcorper dolore aliquam aenean ornare velit lacus, ac varius enim lorem
                ullamcorper dolore. Proin sed aliquam facilisis ante interdum. Sed nulla amet lorem feugiat tempus
                aliquam.</p>
            <ul class="contact">
                <li class="icon solid fa-envelope"><a href="#">information@untitled.tld</a></li>
                <li class="icon solid fa-phone">(000) 000-0000</li>
                <li class="icon solid fa-home">1234 Somewhere Road #8254<br/>
                    Nashville, TN 00000-0000
                </li>
            </ul>
        </section>

        <!-- Chatbot -->
        <section id="chatbot" style="margin: 1.5em;">
            <header class="major">
                <h2>Chatbot</h2>
            </header>
            <div id="chat-window" style="height:200px; overflow-y:auto; background:#fff; border:1px solid #ccc; padding:10px; margin-bottom:10px;"></div>
            <form id="chat-form" th:action="@{/chat}" method="post">
                <input id="chat-input" name="message" type="text" placeholder="Type your message..." style="width:85%; padding:5px;" autocomplete="off"/>
                <button type="submit" style="width:13%; padding:5px;">Send</button>
            </form>
        </section>

        <!-- Footer -->
        <footer id="footer">
            <p class="copyright">&copy; Untitled. All rights reserved. Demo Images: <a href="https://unsplash.com">Unsplash</a>.
                Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
        </footer>

    </div>
</div>

<!-- Scripts -->
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/browser.min.js}"></script>
<script th:src="@{/js/breakpoints.min.js}"></script>
<script th:src="@{/js/util.js}"></script>
<script th:src="@{/js/main.js}"></script>
<script>
document.getElementById('chat-form').addEventListener('submit', function(e) {
    e.preventDefault();
    var inputEl = document.getElementById('chat-input');
    var message = inputEl.value.trim();
    if (!message) return;
    var chatWindow = document.getElementById('chat-window');
    chatWindow.innerHTML += '<div class="user-msg"><strong>You:</strong> ' + message + '</div>';
    inputEl.value = '';
    fetch('/chat', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({message: message})
    })
    .then(response => response.json())
    .then(data => {
        chatWindow.innerHTML += '<div class="bot-msg"><strong>Bot:</strong> ' + data.response + '</div>';
        chatWindow.scrollTop = chatWindow.scrollHeight;
    })
    .catch(function(err) { console.error(err); });
});
</script>
</body>
</html>
